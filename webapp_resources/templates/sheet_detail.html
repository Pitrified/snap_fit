{% extends "base.html" %}

{% block content %}
<div class="breadcrumb">
    <a href="/">Home</a> <span>›</span> <a href="/sheets">Sheets</a> <span>›</span> {{ sheet.sheet_id if sheet else 'Not Found' }}
</div>

{% if sheet %}
<div class="card">
    <h2>Sheet: {{ sheet.sheet_id }}</h2>
    <div class="detail-grid">
        <div class="detail-item">
            <div class="label">Image Path</div>
            <div class="value"><code>{{ sheet.img_path }}</code></div>
        </div>
        <div class="detail-item">
            <div class="label">Piece Count</div>
            <div class="value">{{ sheet.piece_count }}</div>
        </div>
        <div class="detail-item">
            <div class="label">Threshold</div>
            <div class="value">{{ sheet.threshold }}</div>
        </div>
        <div class="detail-item">
            <div class="label">Min Area</div>
            <div class="value">{{ sheet.min_area }}</div>
        </div>
        <div class="detail-item">
            <div class="label">Created</div>
            <div class="value">{{ sheet.created_at.strftime('%Y-%m-%d %H:%M:%S') if sheet.created_at else '-' }}</div>
        </div>
    </div>
</div>

<div class="card">
    <h2>Pieces ({{ pieces|length }})</h2>
    {% if pieces %}
    <table>
        <thead>
            <tr>
                <th>Piece ID</th>
                <th>Type</th>
                <th>Flat Edges</th>
                <th>Contour Points</th>
                <th>Segments</th>
            </tr>
        </thead>
        <tbody>
            {% for piece in pieces %}
            <tr>
                <td><a href="/pieces/{{ piece.piece_id }}">{{ piece.piece_id }}</a></td>
                <td>
                    {% if piece.oriented_piece_type %}
                    <span class="badge badge-info">{{ piece.oriented_piece_type.piece_type }}</span>
                    {% else %}
                    <span class="badge">Unknown</span>
                    {% endif %}
                </td>
                <td>
                    {% for edge in piece.flat_edges %}
                    <span class="badge badge-warning">{{ edge }}</span>
                    {% endfor %}
                    {% if not piece.flat_edges %}-{% endif %}
                </td>
                <td>{{ piece.contour_point_count }}</td>
                <td>
                    {% for edge, shape in piece.segment_shapes.items() %}
                    <span class="badge {% if shape == 'IN' %}badge-success{% elif shape == 'OUT' %}badge-info{% else %}badge-warning{% endif %}">{{ edge }}:{{ shape }}</span>
                    {% endfor %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    {% else %}
    <div class="empty-state">
        <p>No pieces found for this sheet.</p>
    </div>
    {% endif %}
</div>
{% else %}
<div class="card">
    <div class="empty-state">
        <p>Sheet not found.</p>
        <a href="/sheets">← Back to sheets</a>
    </div>
</div>
{% endif %}
{% endblock %}
